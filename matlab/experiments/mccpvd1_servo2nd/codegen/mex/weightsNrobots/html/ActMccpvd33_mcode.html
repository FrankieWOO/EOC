<!-- saved from url=(0014)about:internet -->
<html>
<body>
<script src="resources/eml_report_loadable_data.js"></script>
<div class="dead">
<pre class="code">
<span class="srcline"><span class="lineno"><a href="21,1" id="srcline1">  1</a></span><span class="line"><span class="keyword">classdef</span> ActMccpvd</span></span>
<span class="srcline"><span class="lineno"><a href="21,2" id="srcline2">  2</a></span><span class="line">    <span class="comment">%ACTMCCPVD Summary of this class goes here</span></span></span>
<span class="srcline"><span class="lineno"><a href="21,3" id="srcline3">  3</a></span><span class="line">    <span class="comment">%   Detailed explanation goes here</span></span></span>
<span class="srcline"><span class="lineno"><a href="21,4" id="srcline4">  4</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="21,5" id="srcline5">  5</a></span><span class="line">    <span class="keyword">properties</span></span></span>
<span class="srcline"><span class="lineno"><a href="21,6" id="srcline6">  6</a></span><span class="line">        B = 0.036</span></span>
<span class="srcline"><span class="lineno"><a href="21,7" id="srcline7">  7</a></span><span class="line">        C = 0.135</span></span>
<span class="srcline"><span class="lineno"><a href="21,8" id="srcline8">  8</a></span><span class="line">        A0 = 0.099 <span class="comment">% C - B</span></span></span>
<span class="srcline"><span class="lineno"><a href="21,9" id="srcline9">  9</a></span><span class="line">        Ks = 394 <span class="comment">%231 % spring constant</span></span></span>
<span class="srcline"><span class="lineno"><a href="21,10" id="srcline10"> 10</a></span><span class="line">        r = 0.015</span></span>
<span class="srcline"><span class="lineno"><a href="21,11" id="srcline11"> 11</a></span><span class="line">        gear = 1; <span class="comment">%3/4 % gear ratio between servo1 and link axis</span></span></span>
<span class="srcline"><span class="lineno"><a href="21,12" id="srcline12"> 12</a></span><span class="line">        damping_range = [0, 0.00848]; <span class="comment">% 0.00848</span></span></span>
<span class="srcline"><span class="lineno"><a href="21,13" id="srcline13"> 13</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="21,14" id="srcline14"> 14</a></span><span class="line">        J1 = 0.0099;</span></span>
<span class="srcline"><span class="lineno"><a href="21,15" id="srcline15"> 15</a></span><span class="line">        K1 = 0.3811; <span class="comment">% torque constant</span></span></span>
<span class="srcline"><span class="lineno"><a href="21,16" id="srcline16"> 16</a></span><span class="line">        D1 = 0.2009;</span></span>
<span class="srcline"><span class="lineno"><a href="21,17" id="srcline17"> 17</a></span><span class="line">        R1 = 0.8222;</span></span>
<span class="srcline"><span class="lineno"><a href="21,18" id="srcline18"> 18</a></span><span class="line">        J2 = 0.0099;</span></span>
<span class="srcline"><span class="lineno"><a href="21,19" id="srcline19"> 19</a></span><span class="line">        K2 = 0.3811;</span></span>
<span class="srcline"><span class="lineno"><a href="21,20" id="srcline20"> 20</a></span><span class="line">        D2 = 0.2009;</span></span>
<span class="srcline"><span class="lineno"><a href="21,21" id="srcline21"> 21</a></span><span class="line">        R2 = 0.8222;</span></span>
<span class="srcline"><span class="lineno"><a href="21,22" id="srcline22"> 22</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="21,23" id="srcline23"> 23</a></span><span class="line">        <span class="comment">%%%% - damping motor - %%%%</span></span></span>
<span class="srcline"><span class="lineno"><a href="21,24" id="srcline24"> 24</a></span><span class="line">        gear_d = 20;</span></span>
<span class="srcline"><span class="lineno"><a href="21,25" id="srcline25"> 25</a></span><span class="line">        Kd = 0.0212;</span></span>
<span class="srcline"><span class="lineno"><a href="21,26" id="srcline26"> 26</a></span><span class="line">        Rd = 21.2;</span></span>
<span class="srcline"><span class="lineno"><a href="21,27" id="srcline27"> 27</a></span><span class="line">        ratio_load = 0.5;</span></span>
<span class="srcline"><span class="lineno"><a href="21,28" id="srcline28"> 28</a></span><span class="line">        Rl</span></span>
<span class="srcline"><span class="lineno"><a href="21,29" id="srcline29"> 29</a></span><span class="line">        max_damping_db</span></span>
<span class="srcline"><span class="lineno"><a href="21,30" id="srcline30"> 30</a></span><span class="line">        max_damping</span></span>
<span class="srcline"><span class="lineno"><a href="21,31" id="srcline31"> 31</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="21,32" id="srcline32"> 32</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="21,33" id="srcline33"> 33</a></span><span class="line">    <span class="keyword">methods</span></span></span>
</pre>
</div>
<pre class="code">
<span class="srcline"><span class="lineno"><a href="21,34" id="srcline34"> 34</a></span><span class="line">        <span class="keyword">function</span> <span class="var type1" id="S25T37U74">obj</span> = ActMccpvd(<span class="var type1" id="S26T37U77">varargin</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="21,35" id="srcline35"> 35</a></span><span class="line">            <span class="keyword">if</span> <span class="mxinfo " id="T26:U3"><span class="mxinfo " id="T6:U4">nargin</span> &gt; <span class="mxinfo " id="T6:U5">0</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="21,36" id="srcline36"> 36</a></span><span class="line">                <span class="var type0" id="S28T0U86">param</span> = <span class="var type0" id="S26T0U88">varargin</span>{1};</span></span>
<span class="srcline"><span class="lineno"><a href="21,37" id="srcline37"> 37</a></span><span class="line">                <span class="keyword">if</span> isfield(<span class="var type0" id="S28T0U94">param</span>,<span class="string">'ratio_load'</span>), <span class="var type0" id="S25T0U99">obj</span>.ratio_load = <span class="var type0" id="S28T0U102">param</span>.ratio_load; <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="21,38" id="srcline38"> 38</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="21,39" id="srcline39"> 39</a></span><span class="line">            <span class="mxinfo " id="T6:U6"><span class="mxinfo " id="T6:U7"><span class="var type1" id="S25T37U107">obj</span>.Rl</span> = <span class="mxinfo " id="T6:U9"><span class="mxinfo " id="T6:U10"><span class="var type1" id="S25T37U111">obj</span>.Rd</span>*<span class="mxinfo " id="T6:U12"><span class="var type1" id="S25T37U114">obj</span>.ratio_load</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="21,40" id="srcline40"> 40</a></span><span class="line">            <span class="mxinfo " id="T6:U14"><span class="mxinfo " id="T6:U15"><span class="var type1" id="S25T37U119">obj</span>.max_damping_db</span> = <span class="mxinfo " id="T6:U17"><span class="mxinfo " id="T6:U18"><span class="mxinfo " id="T6:U19"><span class="mxinfo " id="T6:U20"><span class="var type1" id="S25T37U125">obj</span>.Kd</span>^2</span> * <span class="mxinfo " id="T6:U22"><span class="mxinfo " id="T6:U23"><span class="var type1" id="S25T37U130">obj</span>.gear_d</span>^2</span></span>/<span class="mxinfo " id="T6:U25"><span class="var type1" id="S25T37U134">obj</span>.Rd</span></span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="21,41" id="srcline41"> 41</a></span><span class="line">            <span class="mxinfo " id="T6:U27"><span class="mxinfo " id="T6:U28"><span class="var type1" id="S25T37U139">obj</span>.max_damping</span> = <span class="mxinfo " id="T6:U30"><span class="mxinfo " id="T6:U31"><span class="mxinfo " id="T6:U32"><span class="mxinfo " id="T6:U33"><span class="var type1" id="S25T37U145">obj</span>.Kd</span>^2</span> * <span class="mxinfo " id="T6:U35"><span class="mxinfo " id="T6:U36"><span class="var type1" id="S25T37U150">obj</span>.gear_d</span>^2</span></span>/(<span class="mxinfo " id="T6:U38"><span class="mxinfo " id="T6:U39"><span class="var type1" id="S25T37U156">obj</span>.Rd</span>+<span class="mxinfo " id="T6:U41"><span class="var type1" id="S25T37U159">obj</span>.Rl</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="21,42" id="srcline42"> 42</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="21,43" id="srcline43"> 43</a></span><span class="line">        </span></span>
</pre>
<div class="dead">
<pre class="code">
<span class="srcline"><span class="lineno"><a href="21,44" id="srcline44"> 44</a></span><span class="line">        <span class="comment">%variable damping</span></span></span>
<span class="srcline"><span class="lineno"><a href="21,45" id="srcline45"> 45</a></span><span class="line">        <span class="keyword">function</span> d = damping(obj,duty_circle)</span></span>
<span class="srcline"><span class="lineno"><a href="21,46" id="srcline46"> 46</a></span><span class="line">            <span class="comment">% duty_circle: 0-1</span></span></span>
<span class="srcline"><span class="lineno"><a href="21,47" id="srcline47"> 47</a></span><span class="line">            <span class="comment">% </span></span></span>
<span class="srcline"><span class="lineno"><a href="21,48" id="srcline48"> 48</a></span><span class="line">            <span class="comment">% Fan: modified 18/06/17</span></span></span>
<span class="srcline"><span class="lineno"><a href="21,49" id="srcline49"> 49</a></span><span class="line">            d = obj.max_damping*obj.transm(duty_circle);</span></span>
<span class="srcline"><span class="lineno"><a href="21,50" id="srcline50"> 50</a></span><span class="line">            <span class="comment">%d = obj.damping_range(1) + duty_circle.*(obj.damping_range(2)-obj.damping_range(1));</span></span></span>
<span class="srcline"><span class="lineno"><a href="21,51" id="srcline51"> 51</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="21,52" id="srcline52"> 52</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="21,53" id="srcline53"> 53</a></span><span class="line">        <span class="keyword">function</span> tr = transm(obj, u)</span></span>
<span class="srcline"><span class="lineno"><a href="21,54" id="srcline54"> 54</a></span><span class="line">            <span class="comment">% u :- u3</span></span></span>
<span class="srcline"><span class="lineno"><a href="21,55" id="srcline55"> 55</a></span><span class="line">            tr = 1*u;</span></span>
<span class="srcline"><span class="lineno"><a href="21,56" id="srcline56"> 56</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="21,57" id="srcline57"> 57</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="21,58" id="srcline58"> 58</a></span><span class="line">        <span class="keyword">function</span> p = p_damp_charge(obj, qdot, u)</span></span>
<span class="srcline"><span class="lineno"><a href="21,59" id="srcline59"> 59</a></span><span class="line">            p = obj.p_damp_inputelec(qdot,u)* obj.ratio_load/(1+obj.ratio_load);</span></span>
<span class="srcline"><span class="lineno"><a href="21,60" id="srcline60"> 60</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="21,61" id="srcline61"> 61</a></span><span class="line">        <span class="keyword">function</span> p = p_damp_inputelec(obj, qdot, u)</span></span>
<span class="srcline"><span class="lineno"><a href="21,62" id="srcline62"> 62</a></span><span class="line">            p = obj.gear_d^2*obj.Kd^2*qdot^2*obj.transm(u)^2/(obj.Rd+obj.Rl);</span></span>
<span class="srcline"><span class="lineno"><a href="21,63" id="srcline63"> 63</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="21,64" id="srcline64"> 64</a></span><span class="line">        <span class="keyword">function</span> p = p_damp_inputmech(obj, qdot, u)</span></span>
<span class="srcline"><span class="lineno"><a href="21,65" id="srcline65"> 65</a></span><span class="line">            p = obj.gear_d^2*obj.Kd^2*qdot^2*obj.transm(u)/(obj.Rd+obj.Rl);</span></span>
<span class="srcline"><span class="lineno"><a href="21,66" id="srcline66"> 66</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="21,67" id="srcline67"> 67</a></span><span class="line">        <span class="keyword">function</span> torque_damp = torque_damping(obj,qdot, dc)</span></span>
<span class="srcline"><span class="lineno"><a href="21,68" id="srcline68"> 68</a></span><span class="line">            <span class="comment">% damping torque</span></span></span>
<span class="srcline"><span class="lineno"><a href="21,69" id="srcline69"> 69</a></span><span class="line">            <span class="comment">% note size(x,2) == size(u,2)</span></span></span>
<span class="srcline"><span class="lineno"><a href="21,70" id="srcline70"> 70</a></span><span class="line">            torque_damp = qdot.*obj.damping(dc);</span></span>
<span class="srcline"><span class="lineno"><a href="21,71" id="srcline71"> 71</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="21,72" id="srcline72"> 72</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="21,73" id="srcline73"> 73</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="21,74" id="srcline74"> 74</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="21,75" id="srcline75"> 75</a></span><span class="line">        <span class="keyword">function</span> torque = torque(obj, q, qdot, m1, m2, dc)</span></span>
<span class="srcline"><span class="lineno"><a href="21,76" id="srcline76"> 76</a></span><span class="line">            torque = obj.torque_spring(q, m1, m2) - obj.torque_damping(qdot,dc);</span></span>
<span class="srcline"><span class="lineno"><a href="21,77" id="srcline77"> 77</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="21,78" id="srcline78"> 78</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="21,79" id="srcline79"> 79</a></span><span class="line">        <span class="keyword">function</span> torque = torque_spring(obj, q, m1, m2)</span></span>
<span class="srcline"><span class="lineno"><a href="21,80" id="srcline80"> 80</a></span><span class="line">            <span class="comment">%sprdis = model.spring_displacement(x,u);</span></span></span>
<span class="srcline"><span class="lineno"><a href="21,81" id="srcline81"> 81</a></span><span class="line">            <span class="comment">%spring_force = sprdis*model.spring_constant;</span></span></span>
<span class="srcline"><span class="lineno"><a href="21,82" id="srcline82"> 82</a></span><span class="line">            phi = m1/obj.gear - q;</span></span>
<span class="srcline"><span class="lineno"><a href="21,83" id="srcline83"> 83</a></span><span class="line">            A = sqrt( obj.C^2 + obj.B^2 - 2*(obj.B*obj.C).*cos( phi ));</span></span>
<span class="srcline"><span class="lineno"><a href="21,84" id="srcline84"> 84</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="21,85" id="srcline85"> 85</a></span><span class="line">            torque = obj.Ks*(obj.B*obj.C).*sin(phi).*<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="21,86" id="srcline86"> 86</a></span><span class="line">                (1+ (obj.r*m2 - obj.A0)./A );</span></span>
<span class="srcline"><span class="lineno"><a href="21,87" id="srcline87"> 87</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="21,88" id="srcline88"> 88</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="21,89" id="srcline89"> 89</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="21,90" id="srcline90"> 90</a></span><span class="line">        <span class="keyword">function</span> sprlength = spring_displacement(obj, q, theta1, theta2)</span></span>
<span class="srcline"><span class="lineno"><a href="21,91" id="srcline91"> 91</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="21,92" id="srcline92"> 92</a></span><span class="line">            A = sqrt(obj.C^2 + obj.B^2 - 2*obj.B*obj.C*cos(theta1/obj.gear-q));</span></span>
<span class="srcline"><span class="lineno"><a href="21,93" id="srcline93"> 93</a></span><span class="line">            sprlength = A + obj.r*theta2 - obj.A0; </span></span>
<span class="srcline"><span class="lineno"><a href="21,94" id="srcline94"> 94</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="21,95" id="srcline95"> 95</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="21,96" id="srcline96"> 96</a></span><span class="line">        <span class="keyword">function</span> k = stiffness(obj, q, theta1, theta2)</span></span>
<span class="srcline"><span class="lineno"><a href="21,97" id="srcline97"> 97</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="21,98" id="srcline98"> 98</a></span><span class="line">            A = sqrt( obj.C^2 + obj.B^2 - 2*obj.B*obj.C.*cos( theta1/obj.gear-q ) );</span></span>
<span class="srcline"><span class="lineno"><a href="21,99" id="srcline99"> 99</a></span><span class="line">            phi = theta1/obj.gear - q;</span></span>
<span class="srcline"><span class="lineno"><a href="21,100" id="srcline100">100</a></span><span class="line">            k=  obj.Ks*obj.B*obj.C*cos(phi)*( 1 + (obj.r*theta2 - obj.A0)/A ) - <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="21,101" id="srcline101">101</a></span><span class="line">                obj.Ks*(obj.B*obj.C*sin(phi))^2*( obj.r*theta2 - obj.A0 )/A^1.5 ;</span></span>
<span class="srcline"><span class="lineno"><a href="21,102" id="srcline102">102</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="21,103" id="srcline103">103</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="21,104" id="srcline104">104</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="21,105" id="srcline105">105</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="21,106" id="srcline106">106</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="21,107" id="srcline107">107</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="21,108" id="srcline108">108</a></span><span class="line"> </span></span>
</pre>
</div>
</body>
</html>
